<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:ShareX.Ava.UI.ViewModels"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="ShareX.Ava.UI.Views.WorkflowWizardView"
             x:DataType="vm:WorkflowWizardViewModel">
    
    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="5" Margin="0,0,0,20">
            <TextBlock Text="{Binding Title}" FontSize="24" FontWeight="SemiBold"/>
            <TextBlock Text="Select a task type and destination to get started." Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Content -->
        <Grid Grid.Row="1" ColumnDefinitions="250, 20, 300, 20, *" Margin="0,0,0,20">
            
            <!-- Column 1: Job Selection -->
            <Border Grid.Column="0" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
                <Grid RowDefinitions="Auto, *">
                    <TextBlock Text="1. Select Task" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TreeView Grid.Row="1" ItemsSource="{Binding JobCategories}" SelectedItem="{Binding SelectedJob}">
                        <TreeView.DataTemplates>
                            <TreeDataTemplate DataType="vm:JobCategoryViewModel" ItemsSource="{Binding Jobs}">
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                            </TreeDataTemplate>
                            <DataTemplate DataType="vm:HotkeyItemViewModel">
                                <TextBlock Text="{Binding Description}" Margin="0,2"/>
                            </DataTemplate>
                        </TreeView.DataTemplates>
                    </TreeView>
                </Grid>
            </Border>

            <!-- Column 2: Settings -->
            <Border Grid.Column="2" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8" Padding="10">
                <ScrollViewer>
                    <StackPanel Spacing="20">
                         <TextBlock Text="2. Configure" FontWeight="SemiBold"/>
                         
                         <StackPanel Spacing="5">
                             <TextBlock Text="Workflow Name"/>
                             <TextBox Text="{Binding WorkflowName}"/>
                         </StackPanel>
                         
                         <StackPanel Spacing="10">
                             <TextBlock Text="After Capture Tasks" FontWeight="SemiBold" FontSize="12"/>
                             <CheckBox IsChecked="{Binding TaskSaveToFile}" Content="Save image to file"/>
                             <CheckBox IsChecked="{Binding TaskCopyImage}" Content="Copy image to clipboard"/>
                             <CheckBox IsChecked="{Binding TaskUpload}" Content="Upload image"/>
                         </StackPanel>

                         <StackPanel Spacing="10">
                             <TextBlock Text="After Upload Tasks" FontWeight="SemiBold" FontSize="12"/>
                             <CheckBox IsChecked="{Binding TaskCopyUrl}" Content="Copy URL to clipboard"/>
                         </StackPanel>

                         <Separator/>
                         
                         <StackPanel Spacing="5">
                             <TextBlock Text="Summary" FontWeight="SemiBold"/>
                             <TextBlock Text="{Binding ReviewJobName, StringFormat='Task: {0}'}"  Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                             <TextBlock Text="{Binding ReviewDestinationName, StringFormat='Dest: {0}'}" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                         </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Column 3: Destination -->
            <Border Grid.Column="4" Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8" Padding="10"
                    IsVisible="{Binding TaskUpload}">
                 <Grid RowDefinitions="Auto, *">
                    <TextBlock Text="3. Select Destination" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    
                    <ListBox Grid.Row="1" ItemsSource="{Binding AvailableDestinations}" SelectedItem="{Binding SelectedDestination}">
                        <ListBox.DataTemplates>
                            <DataTemplate DataType="vm:UploaderInstanceViewModel">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="{Binding DisplayName}"/>
                                    <TextBlock Text="{Binding Category}" FontSize="10" Foreground="{DynamicResource TextFillColorTertiaryBrush}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.DataTemplates>
                    </ListBox>
                 </Grid>
            </Border>
        </Grid>

        <!-- Footer / Actions (Commands bound from Parent usually, or we expose events? 
             Actually, we can bind buttons here to commands on THIS VM, but the 'Complete' action is on the parent WorkflowsViewModel?
             No, the parent calls 'CompleteWizard'.
             We can bind the buttons in the PARENT View to the commands in the PARENT VM.
             But the "Create" button is inside the Wizard View? 
             Better: WorkflowsView contains the button outside the Wizard control? 
             Or better: Pass the commands into the Wizard? 
             Or use a bound command on the WizardVM that invokes an Action?
             
             Let's put the buttons in the WorkflowsView (containing the Wizard), not inside the WizardView itself, 
             so the WizardView is just the "Form Content". 
             Wait, the mock above includes Row 3. 
             If I put buttons here, I need to command back to Parent.
             
             Let's keep WizardView purely as the form content.
             The buttons will be in the overlay container in WorkflowsView.
        -->
    </Grid>
</UserControl>
