<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:vm="using:ShareX.Ava.UI.ViewModels"
             xmlns:views="using:ShareX.Ava.UI.Views.Controls"
             x:Class="ShareX.Ava.UI.Views.ApplicationSettingsView"
             x:DataType="vm:SettingsViewModel">

    <Design.DataContext>
        <vm:SettingsViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*" Margin="20">
        <TextBlock Grid.Row="0" Text="Application Settings" FontSize="26" FontWeight="SemiBold" Margin="0,0,0,20"/>

        <TabControl Grid.Row="1">
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <!-- System Tray -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="System Tray" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding ShowTray}" Content="Show tray icon"/>
                                    <CheckBox IsChecked="{Binding SilentRun}" Content="Start minimized to tray" IsEnabled="{Binding ShowTray}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Theme Tab -->
            <TabItem Header="Theme">
                 <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                         <StackPanel Spacing="10">
                            <TextBlock Text="Theme" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="Select Application Theme:"/>
                                    <ComboBox SelectedIndex="{Binding SelectedTheme}" Width="200" HorizontalAlignment="Left">
                                        <ComboBoxItem Content="Default"/>
                                        <ComboBoxItem Content="Dark"/>
                                    </ComboBox>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                 </ScrollViewer>
            </TabItem>

            <!-- Paths Tab -->
            <TabItem Header="Paths">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                         <!-- Screenshots Folder -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Screenshots Folder" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding UseCustomScreenshotsPath}" Content="Use custom screenshots path"/>
                                    <Grid ColumnDefinitions="*,Auto" IsEnabled="{Binding UseCustomScreenshotsPath}">
                                        <TextBox Grid.Column="0" Text="{Binding ScreenshotsFolder}" Watermark="Path to screenshots folder"/>
                                        <Button Grid.Column="1" Content="Browse..." Command="{Binding BrowseFolderCommand}" Margin="10,0,0,0"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Subfolder Pattern -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Subfolder Pattern" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <TextBox Text="{Binding SaveImageSubFolderPattern}" Watermark="%y-%mo"/>
                                    <TextBlock Text="Example: 2025-01" FontSize="12" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Integration Tab -->
            <TabItem Header="Integration">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <!-- Windows Integration -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Windows" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox Content="Associate .sxadp files with ShareX.Avalonia"
                                              IsChecked="{Binding IsPluginExtensionRegistered}"
                                              IsVisible="{Binding SupportsFileAssociations}"
                                              ToolTip.Tip="Allows double-clicking .sxadp plugin packages to install them"/>
                                    
                                    <TextBlock Text="Note: File associations require Windows and are managed through the Windows Registry."
                                               FontSize="11"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"
                                               IsVisible="{Binding SupportsFileAssociations}"/>
                                    
                                    <TextBlock Text="File associations are not supported on this platform."
                                               FontSize="11"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               IsVisible="{Binding !SupportsFileAssociations}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>


            <!-- History Tab -->
            <TabItem Header="History">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <!-- History Settings -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="History" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding HistorySaveTasks}" Content="Save captured/uploaded items to history"/>
                                    <CheckBox IsChecked="{Binding HistoryCheckURL}" Content="Only save items with URL"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Recent Tasks Settings -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Recent Tasks" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding RecentTasksSave}" Content="Save recent tasks"/>
                                    
                                    <Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto">
                                        <TextBlock Grid.Column="0" Text="Maximum recent tasks:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="1" 
                                                       Value="{Binding RecentTasksMaxCount}" 
                                                       Minimum="1" Maximum="100" 
                                                       Width="100" Margin="10,0,0,0"/>
                                    </Grid>
                                    
                                    <Separator Margin="0,5"/>
                                    <TextBlock Text="Display Options" FontWeight="SemiBold" FontSize="12"/>
                                    
                                    <CheckBox IsChecked="{Binding RecentTasksShowInMainWindow}" Content="Show recent tasks in main window"/>
                                    <CheckBox IsChecked="{Binding RecentTasksShowInTrayMenu}" Content="Show recent tasks in tray menu"/>
                                    <CheckBox IsChecked="{Binding RecentTasksTrayMenuMostRecentFirst}" 
                                              Content="Show most recent first in tray menu" 
                                              IsEnabled="{Binding RecentTasksShowInTrayMenu}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

             <!-- Proxy Tab -->
            <TabItem Header="Proxy">
                <TextBlock Text="Proxy settings placeholder" Margin="20" Foreground="Gray"/>
            </TabItem>

             <!-- Advanced Tab -->
             <TabItem Header="Advanced">
                <TextBlock Text="Advanced settings placeholder" Margin="20" Foreground="Gray"/>
            </TabItem>
        </TabControl>
        
        <!-- Bottom Action Buttons (Save/Reset) could go here or remain global, but typically per-page saving isn't needed if using immediate binding or main window save -->
    </Grid>
</UserControl>
