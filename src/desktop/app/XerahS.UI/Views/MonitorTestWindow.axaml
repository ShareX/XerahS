<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:XerahS.UI.ViewModels"
        mc:Ignorable="d"
        d:DesignWidth="900" d:DesignHeight="600"
        x:Class="XerahS.UI.Views.MonitorTestWindow"
        x:DataType="vm:MonitorTestViewModel"
        Title="Monitor Test"
        Width="900" Height="600"
        MinWidth="700" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        CanResize="True">

  <Grid RowDefinitions="Auto,*">
    <!-- Toolbar -->
    <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="12,8">
      <StackPanel Orientation="Horizontal" Spacing="8">
        <TextBlock Text="Mode:" VerticalAlignment="Center" Margin="0,0,8,0" />
        <ComboBox ItemsSource="{Binding TestModes}"
                  SelectedItem="{Binding SelectedTestMode}"
                  MinWidth="200"
                  AutomationProperties.Name="Test mode" />
        <Separator Width="1" Height="24" Margin="8,0" />
        <Button Content="Refresh" Command="{Binding RefreshMonitorsCommand}" AutomationProperties.Name="Refresh monitors" />
        <Button Content="Copy Diagnostics" Command="{Binding CopyDiagnosticsCommand}" AutomationProperties.Name="Copy diagnostics" />
        <Button Content="Export..." Command="{Binding ExportDiagnosticsCommand}" AutomationProperties.Name="Export diagnostics" />
        <TextBlock Text="{Binding CursorInfo}" VerticalAlignment="Center" Margin="16,0,0,0"
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
      </StackPanel>
    </Border>

    <!-- Content -->
    <Panel Grid.Row="1">

      <!-- Monitor Diagnostics View -->
      <Grid x:Name="DiagnosticsView"
            ColumnDefinitions="320,*"
            Margin="16">

        <!-- Monitor List -->
        <Border Grid.Column="0"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1"
                Padding="12"
                CornerRadius="4"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
          <ScrollViewer>
            <StackPanel Spacing="8">
              <TextBlock Text="Connected Monitors" FontWeight="Bold" FontSize="14" Margin="0,0,0,8" />
              <ItemsControl ItemsSource="{Binding Monitors}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                            BorderThickness="1"
                            Padding="12"
                            Margin="0,0,0,8"
                            CornerRadius="4"
                            Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
                      <StackPanel Spacing="6">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                          <TextBlock Text="{Binding DeviceName}" FontWeight="Bold" FontSize="13" />
                          <Border Background="Green"
                                  Padding="6,2"
                                  CornerRadius="3"
                                  IsVisible="{Binding IsPrimary}">
                            <TextBlock Text="PRIMARY"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       FontSize="10" />
                          </Border>
                        </StackPanel>

                        <StackPanel Spacing="3">
                          <TextBlock FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                            <Run Text="Resolution: " />
                            <Run Text="{Binding PhysicalBounds.Width, StringFormat={}{0:F0}}" FontWeight="SemiBold" />
                            <Run Text=" × " />
                            <Run Text="{Binding PhysicalBounds.Height, StringFormat={}{0:F0}}" FontWeight="SemiBold" />
                          </TextBlock>

                          <TextBlock FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                            <Run Text="Position: (" />
                            <Run Text="{Binding PhysicalBounds.X, StringFormat={}{0:F0}}" />
                            <Run Text=", " />
                            <Run Text="{Binding PhysicalBounds.Y, StringFormat={}{0:F0}}" />
                            <Run Text=")" />
                          </TextBlock>

                          <TextBlock FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}">
                            <Run Text="DPI: " />
                            <Run Text="{Binding Dpi, StringFormat={}{0:F0}}" FontWeight="SemiBold" />
                            <Run Text=" (" />
                            <Run Text="{Binding ScaleFactor, StringFormat={}{0:F2}}" />
                            <Run Text="× scale)" />
                          </TextBlock>
                        </StackPanel>
                      </StackPanel>
                    </Border>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </ScrollViewer>
        </Border>

        <!-- Layout Map -->
        <Border Grid.Column="1"
                Margin="16,0,0,0"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="1"
                Padding="16"
                CornerRadius="4"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
          <Grid RowDefinitions="Auto,*">
            <TextBlock Grid.Row="0"
                       Text="Monitor Layout"
                       FontWeight="Bold"
                       FontSize="14"
                       Margin="0,0,0,12" />
            <Canvas x:Name="LayoutCanvas"
                    Grid.Row="1"
                    Background="{DynamicResource SystemControlBackgroundAltMediumBrush}"
                    ClipToBounds="True" />
          </Grid>
        </Border>
      </Grid>

      <!-- Visual Test Pattern View -->
      <Border x:Name="TestPatternView" Background="{Binding TestBrush}" />

    </Panel>
  </Grid>
</Window>
