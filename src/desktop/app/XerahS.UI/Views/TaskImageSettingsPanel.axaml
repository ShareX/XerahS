<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:XerahS.UI.ViewModels"
             xmlns:controls="using:XerahS.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="XerahS.UI.Views.TaskImageSettingsPanel"
             x:DataType="vm:TaskSettingsViewModel">

    <TabControl>
        <!-- Image Settings Tab -->
        <TabItem Header="Settings">
            <ScrollViewer Padding="20">
                <Grid ColumnDefinitions="*, 16, *" RowDefinitions="Auto">
                    <!-- Quality -->
                    <StackPanel Grid.Column="0" Spacing="8">
                        <TextBlock Text="Quality" FontWeight="SemiBold"/>
                        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="16">
                            <StackPanel Spacing="16">
                                <Grid ColumnDefinitions="Auto, 16, *">
                                    <TextBlock Grid.Column="0" Text="Format:" VerticalAlignment="Center"/>
                                    <ComboBox Grid.Column="2" ItemsSource="{Binding ImageFormats}" SelectedItem="{Binding ImageFormat}" HorizontalAlignment="Stretch" AutomationProperties.Name="Image Format"/>
                                </Grid>
                                <Grid ColumnDefinitions="Auto, 16, *">
                                    <TextBlock Grid.Column="0" Text="JPEG Quality:" VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Column="2" Value="{Binding ImageJPEGQuality}" Minimum="0" Maximum="100" Increment="1" Width="120" HorizontalAlignment="Left" AutomationProperties.Name="JPEG Quality"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                    <!-- Thumbnail -->
                    <StackPanel Grid.Column="2" Spacing="8">
                        <TextBlock Text="Thumbnail" FontWeight="SemiBold"/>
                        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="16">
                            <StackPanel Spacing="16">
                                <Grid ColumnDefinitions="Auto, 16, *">
                                    <TextBlock Grid.Column="0" Text="Width:" VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Column="2" Value="{Binding ThumbnailWidth}" Minimum="0" Maximum="10000" Increment="10" Width="120" HorizontalAlignment="Left" AutomationProperties.Name="Thumbnail Width"/>
                                </Grid>
                                <Grid ColumnDefinitions="Auto, 16, *">
                                    <TextBlock Grid.Column="0" Text="Height:" VerticalAlignment="Center"/>
                                    <NumericUpDown Grid.Column="2" Value="{Binding ThumbnailHeight}" Minimum="0" Maximum="10000" Increment="10" Width="120" HorizontalAlignment="Left" AutomationProperties.Name="Thumbnail Height"/>
                                </Grid>
                                <Grid ColumnDefinitions="Auto, 16, *">
                                    <TextBlock Grid.Column="0" Text="Name:" VerticalAlignment="Center"/>
                                    <TextBox Grid.Column="2" Text="{Binding ThumbnailName}" AutomationProperties.Name="Thumbnail Name suffix"/>
                                </Grid>
                                <CheckBox IsChecked="{Binding ThumbnailCheckSize}" Content="Save thumbnail only if smaller than image"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </TabItem>

        <!-- Effects Tab -->
        <TabItem Header="Effects">
            <Grid RowDefinitions="Auto, *" Margin="24">
                <!-- Top Toolbar -->
                <Border Grid.Row="0" Margin="0,0,0,16" Background="{DynamicResource ControlFillColorDefaultBrush}" CornerRadius="4" Padding="12">
                     <Grid ColumnDefinitions="*, Auto">
                          <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                              <TextBlock Text="Preset:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                              <TextBlock Text="{Binding ImageEffects.Name}" VerticalAlignment="Center"/>
                          </StackPanel>
                          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                              <Button Command="{Binding ImageEffects.ImportEffectsCommand}" Content="Import..."/>
                              <Button Command="{Binding ImageEffects.SavePresetCommand}" Content="Export..."/>
                          </StackPanel>
                     </Grid>
                </Border>

                <!-- Main Content -->
                <Grid Grid.Row="1" ColumnDefinitions="280, 24, 300, 24, *">
                     <!-- Effects List -->
                     <Grid Grid.Column="0" RowDefinitions="Auto, *, Auto">
                         <TextBlock Grid.Row="0" Text="Active Effects" FontWeight="SemiBold" Margin="0,0,0,8"/>
                         <Border Grid.Row="1" BorderThickness="1" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" CornerRadius="4">
                             <ListBox ItemsSource="{Binding ImageEffects.Effects}" SelectedItem="{Binding ImageEffects.SelectedEffect}" Background="Transparent" BorderThickness="0"
                                      AutomationProperties.Name="Active Effects List">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                             </ListBox>
                         </Border>
                         <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                              <Button Content="Add Effect">
                                  <Button.Flyout>
                                      <Flyout Placement="BottomEdgeAlignedLeft" ShowMode="Standard">
                                          <Menu ItemsSource="{Binding ImageEffects.AvailableEffects}">
                                              <Menu.Styles>
                                                  <Style Selector="MenuItem" x:DataType="vm:EffectCategory">
                                                      <Setter Property="Header" Value="{Binding Name}"/>
                                                      <Setter Property="ItemsSource" Value="{Binding Effects}"/>
                                                  </Style>
                                                  <Style Selector="MenuItem" x:DataType="vm:EffectType">
                                                      <Setter Property="Header" Value="{Binding Name}"/>
                                                      <Setter Property="Command" Value="{Binding $parent[UserControl].DataContext.ImageEffects.AddEffectCommand}"/>
                                                      <Setter Property="CommandParameter" Value="{Binding Type}"/>
                                                  </Style>
                                              </Menu.Styles>
                                          </Menu>
                                      </Flyout>
                                  </Button.Flyout>
                              </Button>
                              <Button Command="{Binding ImageEffects.RemoveEffectCommand}" Content="Remove"/>
                         </StackPanel>
                     </Grid>

                     <!-- Properties -->
                     <Grid Grid.Column="2" RowDefinitions="Auto, *">
                         <TextBlock Grid.Row="0" Text="Properties" FontWeight="SemiBold" Margin="0,0,0,8"/>
                         <Border Grid.Row="1" BorderThickness="1" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" CornerRadius="4" Padding="8">
                              <controls:PropertyGrid x:Name="EffectPropertyGrid" SelectedObject="{Binding ImageEffects.SelectedEffect}" AutomationProperties.Name="Effect Properties"/>
                         </Border>
                     </Grid>

                     <!-- Preview -->
                     <Grid Grid.Column="4" RowDefinitions="Auto, *">
                         <TextBlock Grid.Row="0" Text="Preview" FontWeight="SemiBold" Margin="0,0,0,8"/>
                         <Border Grid.Row="1" BorderThickness="1" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" CornerRadius="4">
                              <Image Source="{Binding ImageEffects.PreviewBitmap}" Stretch="Uniform" Margin="10" AutomationProperties.Name="Effect Preview"/>
                         </Border>
                     </Grid>
                </Grid>
            </Grid>
        </TabItem>
    </TabControl>
</UserControl>
