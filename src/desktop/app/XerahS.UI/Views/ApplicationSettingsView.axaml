<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             xmlns:vm="using:XerahS.UI.ViewModels"
             xmlns:views="using:XerahS.UI.Views.Controls"
             xmlns:controls="using:XerahS.UI.Controls"
             x:Class="XerahS.UI.Views.ApplicationSettingsView"
             x:DataType="vm:SettingsViewModel">

    <Design.DataContext>
        <vm:SettingsViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto, *" Margin="0">
        <TabControl Grid.Row="1">
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">
                        
                        <!-- System -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="System" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding ShowTray}" Content="Show tray icon" AutomationProperties.Name="Show Tray Icon"/>
                                    <CheckBox IsChecked="{Binding SilentRun}" Content="Start minimized to tray" 
                                              IsEnabled="{Binding ShowTray}" AutomationProperties.Name="Start Minimized"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Updates -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Updates" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding AutoCheckUpdate}" Content="Automatically check for updates" AutomationProperties.Name="Auto Check Update"/>
                                    
                                    <Grid ColumnDefinitions="Auto, 16, *" RowDefinitions="Auto">
                                        <TextBlock Grid.Column="0" Text="Update channel:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="2" 
                                                  ItemsSource="{Binding UpdateChannels}"
                                                  SelectedItem="{Binding UpdateChannel}"
                                                  IsEnabled="{Binding AutoCheckUpdate}"
                                                  HorizontalAlignment="Left" Width="200"
                                                  AutomationProperties.Name="Update Channel"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Tray Icon -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Tray Icon" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding TrayIconProgressEnabled}" Content="Show progress on tray icon" AutomationProperties.Name="Show Tray Progress"/>
                                    
                                    <TextBlock Text="Click Actions" FontWeight="SemiBold" FontSize="12" Margin="0,8,0,0"/>

                                    <Grid ColumnDefinitions="120, 16, *" RowDefinitions="Auto, 16, Auto, 16, Auto">
                                        <!-- Row 0: Left Click -->
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Left click:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Row="0" Grid.Column="2" 
                                                  ItemsSource="{Binding TrayClickActions}"
                                                  SelectedItem="{Binding TrayLeftClickAction}"
                                                  HorizontalAlignment="Stretch"
                                                  AutomationProperties.Name="Tray Left Click Action"/>

                                        <!-- Row 2: Double Click -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Double click:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Row="2" Grid.Column="2" 
                                                  ItemsSource="{Binding TrayClickActions}"
                                                  SelectedItem="{Binding TrayLeftDoubleClickAction}"
                                                  HorizontalAlignment="Stretch"
                                                  AutomationProperties.Name="Tray Double Click Action"/>

                                        <!-- Row 4: Middle Click -->
                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Middle click:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Row="4" Grid.Column="2" 
                                                  ItemsSource="{Binding TrayClickActions}"
                                                  SelectedItem="{Binding TrayMiddleClickAction}"
                                                  HorizontalAlignment="Stretch"
                                                  AutomationProperties.Name="Tray Middle Click Action"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Taskbar -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Taskbar" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <CheckBox IsChecked="{Binding TaskbarProgressEnabled}" Content="Show progress on taskbar" AutomationProperties.Name="Show Taskbar Progress"/>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Theme Tab -->
            <TabItem Header="Theme">
                 <ScrollViewer Padding="24">
                     <StackPanel Spacing="24">
                         <StackPanel Spacing="8">
                            <TextBlock Text="Theme" FontWeight="SemiBold"/>
                            <Border BorderThickness="1"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <Grid ColumnDefinitions="Auto, 16, *">
                                        <TextBlock Grid.Column="0" Text="Application Theme:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="2"
                                                  ItemsSource="{Binding ThemeModes}"
                                                  SelectedItem="{Binding ThemeMode}"
                                                  Width="200"
                                                  HorizontalAlignment="Left"
                                                  AutomationProperties.Name="Application Theme"/>
                                    </Grid>
                                    <TextBlock Text="'System default' follows your operating system's light/dark mode preference."
                                               FontSize="12"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                 </ScrollViewer>
            </TabItem>

            <!-- Paths Tab -->
            <TabItem Header="Paths">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">
                         <!-- Screenshots Folder -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Screenshots Folder" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding UseCustomScreenshotsPath}" Content="Use custom screenshots path" AutomationProperties.Name="Use Custom Screenshots Path"/>
                                    <Grid ColumnDefinitions="*, 16, Auto" IsEnabled="{Binding UseCustomScreenshotsPath}">
                                        <TextBox Grid.Column="0" Text="{Binding ScreenshotsFolder}" Watermark="Path to screenshots folder" AutomationProperties.Name="Screenshots Folder Path"/>
                                        <Button Grid.Column="2" Content="Browse..." Command="{Binding BrowseFolderCommand}" AutomationProperties.Name="Browse Screenshots Folder"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Subfolder Pattern -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Subfolder Pattern" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <Grid ColumnDefinitions="Auto, 16, *">
                                        <TextBlock Grid.Column="0" Text="Pattern:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="2" Text="{Binding SaveImageSubFolderPattern}" Watermark="%y-%mo" AutomationProperties.Name="Subfolder Pattern"/>
                                    </Grid>
                                    <TextBlock Text="Example: 2025-01" FontSize="12" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Watch Folders Tab -->
            <TabItem Header="Watch Folders">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Watch folders" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <TextBlock Text="Monitor folders for new files and run file upload workflows automatically."
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>

                                    <Grid ColumnDefinitions="*, 16, Auto">
                                        <TextBlock Grid.Column="0" Text="Configured folders" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                                            <Button Content="Add" Command="{Binding AddWatchFolderCommand}" AutomationProperties.Name="Add Watch Folder"/>
                                            <Button Content="Edit" Command="{Binding EditWatchFolderCommand}" AutomationProperties.Name="Edit Watch Folder"/>
                                            <Button Content="Remove" Command="{Binding RemoveWatchFolderCommand}" AutomationProperties.Name="Remove Watch Folder"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Watch Folder List Header -->
                                    <Grid ColumnDefinitions="80, 90, 2*, 150, 120, 120, 150, 120" Margin="4,0,4,0">
                                        <TextBlock Grid.Column="0" Text="Enabled" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="1" Text="Status" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="2" Text="Folder" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="3" Text="Workflow" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="4" Text="Filter" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="5" Text="Subfolders" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="6" Text="Move to Screenshots" FontWeight="SemiBold" FontSize="12"/>
                                        <TextBlock Grid.Column="7" Text="MOV to MP4" FontWeight="SemiBold" FontSize="12"/>
                                    </Grid>

                                    <Border BorderThickness="1" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" CornerRadius="4">
                                        <ListBox ItemsSource="{Binding WatchFolders}"
                                                 SelectedItem="{Binding SelectedWatchFolder}"
                                                 MinHeight="140"
                                                 AutomationProperties.Name="Watch Folders List">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate x:DataType="vm:WatchFolderSettingsViewModel">
                                                    <Grid ColumnDefinitions="80, 90, 2*, 150, 120, 120, 150, 120" Margin="6">
                                                        <CheckBox Grid.Column="0" IsChecked="{Binding Enabled}" AutomationProperties.Name="Enable Watch Folder"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding StatusText}" VerticalAlignment="Center" ToolTip.Tip="{Binding StatusDetail}"/>
                                                        <TextBlock Grid.Column="2" Text="{Binding FolderPath}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding FolderPath}"/>
                                                        <TextBlock Grid.Column="3" Text="{Binding WorkflowName}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding WorkflowName}"/>
                                                        <TextBlock Grid.Column="4" Text="{Binding Filter}" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="5" Text="{Binding IncludeSubdirectoriesText}" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="6" Text="{Binding MoveFilesToScreenshotsFolderText}" VerticalAlignment="Center"/>
                                                        <TextBlock Grid.Column="7" Text="{Binding ConvertMovToMp4BeforeProcessingText}" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </Border>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <StackPanel Spacing="8">
                            <TextBlock Text="Watch Folder Service/Daemon" FontWeight="SemiBold"/>
                            <Border BorderThickness="1"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4"
                                    Padding="16">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Run watch-folder monitoring in a dedicated background service/daemon using your existing settings."
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>

                                    <Grid ColumnDefinitions="Auto, 16, *"
                                          IsVisible="{Binding ShowWatchFolderDaemonScopeSelector}">
                                        <TextBlock Grid.Column="0" Text="Scope:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="2"
                                                  ItemsSource="{Binding WatchFolderDaemonScopes}"
                                                  SelectedItem="{Binding WatchFolderDaemonScope}"
                                                  Width="180"
                                                  HorizontalAlignment="Left"
                                                  AutomationProperties.Name="Watch Folder Daemon Scope"/>
                                    </Grid>

                                    <CheckBox IsChecked="{Binding WatchFolderDaemonStartAtStartup}"
                                              Content="Start daemon at startup"
                                              AutomationProperties.Name="Watch Folder Daemon Startup"/>

                                    <Grid ColumnDefinitions="*, 12, Auto, 8, Auto"
                                          VerticalAlignment="Center">
                                        <StackPanel Grid.Column="0" Spacing="4">
                                            <TextBlock Text="{Binding WatchFolderDaemonStatusText}" TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding WatchFolderDaemonLastError}"
                                                       TextWrapping="Wrap"
                                                       Foreground="{DynamicResource SystemFillColorCriticalBrush}"/>
                                        </StackPanel>

                                        <Button Grid.Column="2"
                                                Content="Refresh"
                                                Command="{Binding RefreshWatchFolderDaemonStatusCommand}"
                                                AutomationProperties.Name="Refresh Watch Folder Daemon Status"/>

                                        <Button Grid.Column="4"
                                                Content="{Binding WatchFolderDaemonButtonText}"
                                                Command="{Binding ToggleWatchFolderDaemonCommand}"
                                                IsEnabled="{Binding WatchFolderDaemonSupported}"
                                                AutomationProperties.Name="Toggle Watch Folder Daemon"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Integration Tab -->
            <TabItem Header="Integration">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">
                        <!-- OS Integration -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="System Integration" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding RunAtStartup}" 
                                              Content="Run at system startup" AutomationProperties.Name="Run at Startup"/>
                                    <CheckBox IsChecked="{Binding EnableContextMenuIntegration}" 
                                              Content="Add 'Upload with ShareX' to context menu"
                                              ToolTip.Tip="Adds an option to upload files from the right-click context menu"
                                              AutomationProperties.Name="Enable Context Menu Integration"/>
                                    <CheckBox IsChecked="{Binding EnableSendToIntegration}" 
                                              Content="Add to 'Send To' menu"
                                              ToolTip.Tip="Adds ShareX to the 'Send To' menu for quick file access"
                                              AutomationProperties.Name="Enable Send To Integration"/>
                                              
                                    <TextBlock Text="File Associations" FontWeight="SemiBold" FontSize="12" Margin="0,8,0,0"/>
                                    
                                    <CheckBox Content="Associate .xsdp files with this application"
                                              IsChecked="{Binding IsPluginExtensionRegistered}"
                                              IsVisible="{Binding SupportsFileAssociations}"
                                              ToolTip.Tip="Allows double-clicking .xsdp plugin packages to install them"
                                              AutomationProperties.Name="Associate XSDP Files"/>
                                    
                                    <TextBlock Text="Note: Some integration features require platform-specific support and may not be available on all systems."
                                               FontSize="11"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- History Tab -->
            <TabItem Header="History">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">
                        <!-- History Settings -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="History" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding HistorySaveTasks}" Content="Save captured/uploaded items to history" AutomationProperties.Name="Save Tasks to History"/>
                                    <CheckBox IsChecked="{Binding HistoryCheckURL}" Content="Only save items with URL" AutomationProperties.Name="Only Save Tasks with URL"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Recent Tasks Settings -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Recent Tasks" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding RecentTasksSave}" Content="Save recent tasks" AutomationProperties.Name="Save Recent Tasks"/>
                                    
                                    <Grid ColumnDefinitions="Auto, 16, Auto">
                                        <TextBlock Grid.Column="0" Text="Maximum recent tasks:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="2" 
                                                       Value="{Binding RecentTasksMaxCount}" 
                                                       Minimum="1" Maximum="100" 
                                                       Width="120" HorizontalAlignment="Left"
                                                       AutomationProperties.Name="Max Recent Tasks"/>
                                    </Grid>
                                    
                                    <TextBlock Text="Display Options" FontWeight="SemiBold" FontSize="12" Margin="0,8,0,0"/>
                                    
                                    <CheckBox IsChecked="{Binding RecentTasksShowInMainWindow}" Content="Show recent tasks in main window" AutomationProperties.Name="Show Recent Tasks in Main Window"/>
                                    <CheckBox IsChecked="{Binding RecentTasksShowInTrayMenu}" Content="Show recent tasks in tray menu" AutomationProperties.Name="Show Recent Tasks in Tray Menu"/>
                                    <CheckBox IsChecked="{Binding RecentTasksTrayMenuMostRecentFirst}" 
                                              Content="Show most recent first in tray menu" 
                                              IsEnabled="{Binding RecentTasksShowInTrayMenu}"
                                              AutomationProperties.Name="Show Recent Tasks First"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

             <!-- Proxy Tab -->
            <TabItem Header="Proxy">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">

                        <!-- Proxy Method -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Proxy Configuration" FontWeight="SemiBold"/>
                            <Border BorderThickness="1"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <Grid ColumnDefinitions="Auto, 16, *">
                                        <TextBlock Grid.Column="0" Text="Proxy method:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="2"
                                                  ItemsSource="{Binding ProxyMethods}"
                                                  SelectedItem="{Binding ProxyMethod}"
                                                  HorizontalAlignment="Left" Width="200"
                                                  AutomationProperties.Name="Proxy Method"/>
                                    </Grid>
                                    <TextBlock Text="Configure how network requests should be proxied. Changes apply immediately to all uploads."
                                               FontSize="12"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Manual Proxy Settings -->
                        <StackPanel Spacing="8" IsVisible="{Binding IsManualProxy}">
                            <TextBlock Text="Proxy Server" FontWeight="SemiBold"/>
                            <Border BorderThickness="1"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <Grid ColumnDefinitions="100, 16, *">
                                        <TextBlock Grid.Column="0" Text="Host:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="2" Text="{Binding ProxyHost}"
                                                 Watermark="proxy.example.com"
                                                 AutomationProperties.Name="Proxy Host"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="100, 16, *">
                                        <TextBlock Grid.Column="0" Text="Port:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="2"
                                                       Value="{Binding ProxyPort}"
                                                       Minimum="1" Maximum="65535"
                                                       Width="120" HorizontalAlignment="Left"
                                                       AutomationProperties.Name="Proxy Port"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Authentication -->
                        <StackPanel Spacing="8" IsVisible="{Binding IsManualProxy}">
                            <TextBlock Text="Authentication (Optional)" FontWeight="SemiBold"/>
                            <Border BorderThickness="1"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <Grid ColumnDefinitions="100, 16, *">
                                        <TextBlock Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="2" Text="{Binding ProxyUsername}"
                                                 Watermark="username"
                                                 AutomationProperties.Name="Proxy Username"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="100, 16, *">
                                        <TextBlock Grid.Column="0" Text="Password:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="2" Text="{Binding ProxyPassword}"
                                                 Watermark="password"
                                                 PasswordChar="â€¢"
                                                 AutomationProperties.Name="Proxy Password"/>
                                    </Grid>
                                    <TextBlock Text="Leave username and password blank if your proxy does not require authentication."
                                               FontSize="12"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

             <!-- Advanced Tab -->
             <TabItem Header="Advanced">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="24">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Capture Engine" FontWeight="SemiBold"/>
                            <Border BorderThickness="1" 
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                                    CornerRadius="4" Padding="16">
                                <StackPanel Spacing="16">
                                    <CheckBox IsChecked="{Binding UseModernCapture}" Content="Use Modern Screen Capture (Direct3D11 on Windows, XDG Portal on Linux). Requires restart." AutomationProperties.Name="Use Modern Capture"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                        
                        <StackPanel Spacing="8">
                            <TextBlock Text="Application Configuration" FontWeight="SemiBold"/>
                            <Border BorderThickness="1"
                                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                    CornerRadius="4" Padding="16">
                                <controls:PropertyGrid x:Name="ApplicationConfigPropertyGrid"
                                                       SelectedObject="{Binding ApplicationConfig}"
                                                       AutomationProperties.Name="Application Config Properties"/>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
