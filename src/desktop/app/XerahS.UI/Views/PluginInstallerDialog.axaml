<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:XerahS.UI.ViewModels"
        x:Class="XerahS.UI.Views.PluginInstallerDialog"
        x:DataType="vm:PluginInstallerViewModel"
        Title="Install Plugin"
        Icon="/Assets/Logo.ico"
        Width="540" Height="450"
        CanResize="False"
        WindowStartupLocation="CenterOwner">
    
    <Grid Margin="24" RowDefinitions="Auto, *, Auto">
        
        <!-- Header -->
        <TextBlock Grid.Row="0" Text="Install Plugin" Theme="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,24"/>

        <!-- Main Content -->
        <StackPanel Grid.Row="1" Spacing="24">
            
            <!-- File Selection -->
            <StackPanel Spacing="8">
                <TextBlock Text="Plugin Package (.xsdp)" Theme="{StaticResource BodyStrongTextBlockStyle}"/>
                <Grid ColumnDefinitions="*, Auto" ColumnSpacing="8">
                    <TextBox Grid.Column="0" 
                             Text="{Binding PackageFilePath}" 
                             IsReadOnly="True"
                             Watermark="Select a .xsdp file..."
                             AutomationProperties.Name="Plugin Package Path"/>
                    <Button Grid.Column="1" 
                            Content="Browse" 
                            Command="{Binding BrowsePackageCommand}"
                            AutomationProperties.Name="Browse Plugin Package"/>
                </Grid>
            </StackPanel>
            
            <!-- Plugin Info Card -->
            <Border Theme="{StaticResource CardBorderTheme}" 
                    IsVisible="{Binding Manifest, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel Spacing="12">
                    <Grid ColumnDefinitions="*, Auto">
                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock Text="{Binding Manifest.Name}" Theme="{StaticResource SubtitleTextBlockStyle}"/>
                            <TextBlock Text="{Binding ManifestVersionAuthor}" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                        <!-- Type/Category Badge could go here in future -->
                    </Grid>
                    
                    <TextBlock Text="{Binding Manifest.Description}" TextWrapping="Wrap" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                    
                    <Separator/>
                    
                    <Grid ColumnDefinitions="Auto, *" RowDefinitions="Auto, Auto" RowSpacing="4" ColumnSpacing="12">
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="ID:" Foreground="{DynamicResource TextFillColorTertiaryBrush}"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Manifest.PluginId}" FontFamily="Consolas"/>
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="API:" Foreground="{DynamicResource TextFillColorTertiaryBrush}"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Manifest.ApiVersion}"/>
                    </Grid>
                    
                    <TextBlock Text="{Binding ManifestCategories}"  FontSize="12" Foreground="{DynamicResource TextFillColorTertiaryBrush}"/>
                </StackPanel>
            </Border>

            <!-- Error Message -->
             <Border Background="{DynamicResource SystemFillColorCriticalBackgroundBrush}"
                    BorderBrush="{DynamicResource SystemFillColorCriticalBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="12"
                    IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="{DynamicResource SystemFillColorCriticalBrush}"
                           TextWrapping="Wrap"/>
            </Border>

        </StackPanel>

        <!-- Footer Actions -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" Margin="0,24,0,0">
            <Button Content="Install" 
                    Command="{Binding InstallCommand}"
                    IsEnabled="{Binding CanInstall}"
                    Classes="accent"
                    AutomationProperties.Name="Install Plugin"/>
            <Button Content="Cancel" 
                    Command="{Binding CancelCommand}"
                    AutomationProperties.Name="Cancel Installation"/>
        </StackPanel>

    </Grid>
</Window>
