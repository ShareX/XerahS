<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:vm="using:XerahS.UI.ViewModels"
        mc:Ignorable="d"
        x:Class="XerahS.UI.Views.WatchFolderDialog"
        x:DataType="vm:WatchFolderEditViewModel"
        Width="520"
        SizeToContent="Height"
        WindowStartupLocation="CenterOwner"
        Title="{Binding Title}">

    <Design.DataContext>
        <vm:WatchFolderEditViewModel />
    </Design.DataContext>

    <StackPanel Margin="24" Spacing="24">
        <TextBlock Text="{Binding Title}" Theme="{StaticResource SubtitleTextBlockStyle}"/>

        <StackPanel Spacing="8">
            <TextBlock Text="Folder path" Theme="{StaticResource BodyStrongTextBlockStyle}"/>
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                <TextBox Grid.Column="0"
                         Text="{Binding FolderPath, UpdateSourceTrigger=PropertyChanged}"
                         Watermark="C:\Path\To\Folder"
                         AutomationProperties.Name="Folder Path Input"/>
                <Button Grid.Column="1"
                        Content="Browse..."
                        Command="{Binding BrowseFolderCommand}"
                        AutomationProperties.Name="Browse Folder"/>
            </Grid>
            <TextBlock Text="{Binding FolderPathError}"
                       Foreground="{DynamicResource SystemFillColorCriticalBrush}"
                       Theme="{StaticResource CaptionTextBlockStyle}"
                       IsVisible="{Binding HasFolderPathError}"/>
        </StackPanel>

        <StackPanel Spacing="8">
            <TextBlock Text="Filter Pattern" Theme="{StaticResource BodyStrongTextBlockStyle}"/>
            <TextBox Text="{Binding Filter, UpdateSourceTrigger=PropertyChanged}"
                     Watermark="*.png;*.jpg"
                     AutomationProperties.Name="Filter Pattern Input"/>
            <TextBlock Text="Separate multiple patterns with ';' (example: *.png;*.jpg)."
                       Theme="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
            <TextBlock Text="{Binding FilterError}"
                       Foreground="{DynamicResource SystemFillColorCriticalBrush}"
                       Theme="{StaticResource CaptionTextBlockStyle}"
                       IsVisible="{Binding HasFilterError}"/>
        </StackPanel>

        <StackPanel Spacing="8">
            <TextBlock Text="Workflow" Theme="{StaticResource BodyStrongTextBlockStyle}"/>
            <ComboBox ItemsSource="{Binding Workflows}"
                      SelectedItem="{Binding SelectedWorkflow}"
                      DisplayMemberBinding="{Binding Name}"
                      HorizontalAlignment="Stretch"
                      AutomationProperties.Name="Workflow Selection"/>
            <TextBlock Text="{Binding WorkflowError}"
                       Foreground="{DynamicResource SystemFillColorCriticalBrush}"
                       Theme="{StaticResource CaptionTextBlockStyle}"
                       IsVisible="{Binding HasWorkflowError}"/>
        </StackPanel>

        <StackPanel Spacing="8">
            <CheckBox IsChecked="{Binding IncludeSubdirectories}" 
                      Content="Include subfolders"
                      AutomationProperties.Name="Include Subfolders Checkbox"/>
            <CheckBox IsChecked="{Binding MoveFilesToScreenshotsFolder}" 
                      Content="Move files to screenshots folder after processing"
                      AutomationProperties.Name="Move Files Checkbox"/>
            <CheckBox IsChecked="{Binding ConvertMovToMp4BeforeProcessing}"
                      Content="Convert .mov files to .mp4 before processing"
                      AutomationProperties.Name="Convert MOV Files Checkbox"/>
            <CheckBox IsChecked="{Binding Enabled}" 
                      Content="Enable this watch folder"
                      AutomationProperties.Name="Enable Watch Folder Checkbox"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12">
            <Button Content="Cancel" Command="{Binding CancelCommand}" AutomationProperties.Name="Cancel"/>
            <Button Content="Save" Command="{Binding SaveCommand}" IsEnabled="{Binding CanSave}" Classes="accent" AutomationProperties.Name="Save"/>
        </StackPanel>
    </StackPanel>
</Window>
