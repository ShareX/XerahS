<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:vm="using:XerahS.UI.ViewModels"
             xmlns:views="using:XerahS.UI.Views.Controls"
             x:Class="XerahS.UI.Views.ApplicationSettingsView"
             x:DataType="vm:SettingsViewModel">

    <Design.DataContext>
        <vm:SettingsViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*" Margin="20">
        <TextBlock Grid.Row="0" Text="Application Settings" FontSize="26" FontWeight="SemiBold" Margin="0,0,0,20"/>

        <TabControl Grid.Row="1">
            <!-- General Tab -->
            <TabItem Header="General">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <!-- System -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="System" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding ShowTray}" Content="Show tray icon"/>
                                    <CheckBox IsChecked="{Binding SilentRun}" Content="Start minimized to tray" IsEnabled="{Binding ShowTray}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Updates -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Updates" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding AutoCheckUpdate}" Content="Automatically check for updates"/>
                                     <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto">
                                         <TextBlock Grid.Column="0" 
                                                   Text="Update channel:" 
                                                   VerticalAlignment="Center" 
                                                   Margin="0,0,10,0"/>
                                         <ComboBox Grid.Column="1" 
                                                  ItemsSource="{Binding UpdateChannels}"
                                                  SelectedItem="{Binding UpdateChannel}"
                                                  IsEnabled="{Binding AutoCheckUpdate}"
                                                  HorizontalAlignment="Left"
                                                  Width="150"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Tray Icon -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Tray Icon" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding TrayIconProgressEnabled}" Content="Show progress on tray icon"/>
                                    
                                    <Separator Margin="0,5"/>
                                    <TextBlock Text="Click Actions" FontWeight="SemiBold" FontSize="12"/>

                                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" Margin="0,5,0,0">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Left click:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                                        <ComboBox Grid.Row="0" Grid.Column="1" 
                                                  ItemsSource="{Binding TrayClickActions}"
                                                  SelectedItem="{Binding TrayLeftClickAction}"
                                                  HorizontalAlignment="Stretch" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Double click:" VerticalAlignment="Center" Margin="0,0,10,5"/>
                                        <ComboBox Grid.Row="1" Grid.Column="1" 
                                                  ItemsSource="{Binding TrayClickActions}"
                                                  SelectedItem="{Binding TrayLeftDoubleClickAction}"
                                                  HorizontalAlignment="Stretch" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Middle click:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <ComboBox Grid.Row="2" Grid.Column="1" 
                                                  ItemsSource="{Binding TrayClickActions}"
                                                  SelectedItem="{Binding TrayMiddleClickAction}"
                                                  HorizontalAlignment="Stretch"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Taskbar -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Taskbar" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding TaskbarProgressEnabled}" Content="Show progress on taskbar"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Theme Tab -->
            <TabItem Header="Theme">
                 <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                         <StackPanel Spacing="10">
                            <TextBlock Text="Theme" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="Select Application Theme:"/>
                                    <ComboBox SelectedIndex="{Binding SelectedTheme}" Width="200" HorizontalAlignment="Left">
                                        <ComboBoxItem Content="Default"/>
                                        <ComboBoxItem Content="Dark"/>
                                    </ComboBox>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                 </ScrollViewer>
            </TabItem>

            <!-- Paths Tab -->
            <TabItem Header="Paths">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                         <!-- Screenshots Folder -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Screenshots Folder" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding UseCustomScreenshotsPath}" Content="Use custom screenshots path"/>
                                    <Grid ColumnDefinitions="*,Auto" IsEnabled="{Binding UseCustomScreenshotsPath}">
                                        <TextBox Grid.Column="0" Text="{Binding ScreenshotsFolder}" Watermark="Path to screenshots folder"/>
                                        <Button Grid.Column="1" Content="Browse..." Command="{Binding BrowseFolderCommand}" Margin="10,0,0,0"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Subfolder Pattern -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Subfolder Pattern" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <TextBox Text="{Binding SaveImageSubFolderPattern}" Watermark="%y-%mo"/>
                                    <TextBlock Text="Example: 2025-01" FontSize="12" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Integration Tab -->
            <TabItem Header="Integration">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <!-- OS Integration -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="System Integration" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding RunAtStartup}" 
                                              Content="Run at system startup"/>
                                    <CheckBox IsChecked="{Binding EnableContextMenuIntegration}" 
                                              Content="Add 'Upload with ShareX' to context menu"
                                              ToolTip.Tip="Adds an option to upload files from the right-click context menu"/>
                                    <CheckBox IsChecked="{Binding EnableSendToIntegration}" 
                                              Content="Add to 'Send To' menu"
                                              ToolTip.Tip="Adds ShareX to the 'Send To' menu for quick file access"/>
                                              
                                    <Separator Margin="0,5"/>
                                    <TextBlock Text="File Associations" FontWeight="SemiBold" FontSize="12"/>
                                    
                                    <CheckBox Content="Associate .xsdp files with this application"
                                              IsChecked="{Binding IsPluginExtensionRegistered}"
                                              IsVisible="{Binding SupportsFileAssociations}"
                                              ToolTip.Tip="Allows double-clicking .xsdp plugin packages to install them"/>
                                    
                                    <TextBlock Text="Note: Some integration features require platform-specific support and may not be available on all systems."
                                               FontSize="11"
                                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>


            <!-- History Tab -->
            <TabItem Header="History">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <!-- History Settings -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="History" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding HistorySaveTasks}" Content="Save captured/uploaded items to history"/>
                                    <CheckBox IsChecked="{Binding HistoryCheckURL}" Content="Only save items with URL"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Recent Tasks Settings -->
                        <StackPanel Spacing="10">
                            <TextBlock Text="Recent Tasks" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding RecentTasksSave}" Content="Save recent tasks"/>
                                    
                                    <Grid ColumnDefinitions="Auto,Auto,*" RowDefinitions="Auto">
                                        <TextBlock Grid.Column="0" Text="Maximum recent tasks:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="1" 
                                                       Value="{Binding RecentTasksMaxCount}" 
                                                       Minimum="1" Maximum="100" 
                                                       Width="100" Margin="10,0,0,0"/>
                                    </Grid>
                                    
                                    <Separator Margin="0,5"/>
                                    <TextBlock Text="Display Options" FontWeight="SemiBold" FontSize="12"/>
                                    
                                    <CheckBox IsChecked="{Binding RecentTasksShowInMainWindow}" Content="Show recent tasks in main window"/>
                                    <CheckBox IsChecked="{Binding RecentTasksShowInTrayMenu}" Content="Show recent tasks in tray menu"/>
                                    <CheckBox IsChecked="{Binding RecentTasksTrayMenuMostRecentFirst}" 
                                              Content="Show most recent first in tray menu" 
                                              IsEnabled="{Binding RecentTasksShowInTrayMenu}"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

             <!-- Proxy Tab -->
            <TabItem Header="Proxy">
                <TextBlock Text="Proxy settings placeholder" Margin="20" Foreground="Gray"/>
            </TabItem>

             <!-- Advanced Tab -->
             <TabItem Header="Advanced">
                <ScrollViewer>
                    <StackPanel Margin="20" Spacing="20">
                        <StackPanel Spacing="10">
                            <TextBlock Text="Capture Engine" FontWeight="SemiBold"/>
                            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="4" Padding="10">
                                <StackPanel Spacing="10">
                                    <CheckBox IsChecked="{Binding UseModernCapture}" Content="Use Modern Screen Capture (Direct3D11)"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- Bottom Action Buttons (Save/Reset) could go here or remain global, but typically per-page saving isn't needed if using immediate binding or main window save -->
    </Grid>
</UserControl>
