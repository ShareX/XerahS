<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:XerahS.UI.ViewModels"
        xmlns:media="using:XerahS.Media"
        mc:Ignorable="d"
        d:DesignWidth="600" d:DesignHeight="450"
        x:Class="XerahS.UI.Views.VideoConverterWindow"
        x:DataType="vm:VideoConverterViewModel"
        Title="Video Converter"
        Width="600" Height="480"
        MinWidth="500" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        CanResize="True">

  <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,*,Auto" Margin="16">

    <!-- Row 0: Input file -->
    <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,12">
      <TextBox Grid.Column="0"
               Text="{Binding InputFilePath}"
               Watermark="Select a video file..."
               IsReadOnly="True"
               AutomationProperties.Name="Input file path" />
      <Button Grid.Column="1"
              Content="Browse..."
              Command="{Binding BrowseInputCommand}"
              Margin="8,0,0,0"
              MinWidth="90"
              AutomationProperties.Name="Browse input file" />
    </Grid>

    <!-- Row 1: Codec -->
    <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
      <TextBlock Text="Codec:" VerticalAlignment="Center" />
      <ComboBox SelectedItem="{Binding SelectedCodec}"
                MinWidth="180"
                AutomationProperties.Name="Video codec">
        <ComboBox.Items>
          <media:ConverterVideoCodecs>x264</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>x265</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>h264_nvenc</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>hevc_nvenc</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>h264_amf</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>hevc_amf</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>h264_qsv</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>hevc_qsv</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>vp8</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>vp9</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>av1</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>xvid</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>gif</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>webp</media:ConverterVideoCodecs>
          <media:ConverterVideoCodecs>apng</media:ConverterVideoCodecs>
        </ComboBox.Items>
      </ComboBox>
    </StackPanel>

    <!-- Row 2: Quality -->
    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="16" Margin="0,0,0,12">
      <CheckBox Content="Use bitrate"
                IsChecked="{Binding VideoQualityUseBitrate}"
                VerticalAlignment="Center"
                AutomationProperties.Name="Use bitrate mode" />

      <StackPanel Orientation="Horizontal" Spacing="6"
                  IsVisible="{Binding !VideoQualityUseBitrate}">
        <TextBlock Text="Quality (CRF):" VerticalAlignment="Center" />
        <NumericUpDown Value="{Binding VideoQuality}"
                       Minimum="0" Maximum="63" Increment="1"
                       MinWidth="80"
                       AutomationProperties.Name="Video quality CRF" />
      </StackPanel>

      <StackPanel Orientation="Horizontal" Spacing="6"
                  IsVisible="{Binding VideoQualityUseBitrate}">
        <TextBlock Text="Bitrate (kbps):" VerticalAlignment="Center" />
        <NumericUpDown Value="{Binding VideoQualityBitrate}"
                       Minimum="100" Maximum="100000" Increment="100"
                       MinWidth="100"
                       AutomationProperties.Name="Video bitrate" />
      </StackPanel>
    </StackPanel>

    <!-- Row 3: Custom arguments -->
    <StackPanel Grid.Row="3" Margin="0,0,0,12">
      <CheckBox Content="Use custom FFmpeg arguments"
                IsChecked="{Binding UseCustomArguments}"
                AutomationProperties.Name="Use custom arguments" />
      <TextBox Text="{Binding CustomArguments}"
               Watermark="Custom FFmpeg arguments..."
               IsVisible="{Binding UseCustomArguments}"
               Margin="0,6,0,0"
               AutomationProperties.Name="Custom arguments" />
    </StackPanel>

    <!-- Row 4: Args preview -->
    <TextBox Grid.Row="4"
             Text="{Binding PreviewArgs}"
             IsReadOnly="True"
             Watermark="FFmpeg arguments preview"
             Margin="0,0,0,12"
             FontFamily="Consolas"
             FontSize="11"
             AutomationProperties.Name="Arguments preview" />

    <!-- Row 5: Output -->
    <Grid Grid.Row="5" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,12">
      <TextBlock Grid.Column="0" Text="Output:" VerticalAlignment="Center" Margin="0,0,8,0" />
      <TextBox Grid.Column="1"
               Text="{Binding OutputFolder}"
               IsReadOnly="True"
               AutomationProperties.Name="Output folder" />
      <Button Grid.Column="2"
              Content="Browse..."
              Command="{Binding BrowseOutputCommand}"
              Margin="8,0,0,0"
              MinWidth="90"
              AutomationProperties.Name="Browse output folder" />
    </Grid>

    <!-- Row 6: Progress -->
    <StackPanel Grid.Row="6" Margin="0,0,0,8">
      <ProgressBar Value="{Binding ProgressPercent}"
                   Minimum="0" Maximum="100"
                   IsVisible="{Binding IsConverting}" />
      <TextBlock Text="{Binding StatusText}" Margin="0,4,0,0" />
    </StackPanel>

    <!-- Row 7: Spacer -->

    <!-- Row 8: Buttons -->
    <StackPanel Grid.Row="8" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
      <Button Content="Convert"
              Command="{Binding ConvertCommand}"
              MinWidth="100"
              Classes="accent"
              IsVisible="{Binding !IsConverting}"
              IsEnabled="{Binding HasInput}"
              AutomationProperties.Name="Convert video" />
      <Button Content="Stop"
              Command="{Binding StopCommand}"
              MinWidth="100"
              IsVisible="{Binding IsConverting}"
              AutomationProperties.Name="Stop conversion" />
      <Button Content="Close"
              Click="OnCloseClick"
              MinWidth="80"
              AutomationProperties.Name="Close" />
    </StackPanel>

  </Grid>
</Window>
